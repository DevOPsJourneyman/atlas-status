{% extends "base.html" %}

{% block content %}

<!-- Countdown refresh bar -->
<div class="countdown-wrap">
    <div class="countdown-fill"></div>
</div>

<!-- Host stats -->
{% if docker_info %}
<div class="section-title">Host — {{ docker_info.host }}</div>
<div class="stat-strip">
    <div class="stat-cell">
        <div class="val" style="color:var(--green)">{{ docker_info.containers_running }}</div>
        <div class="lbl">Running</div>
    </div>
    <div class="stat-cell">
        <div class="val" style="color:var(--text-dim)">{{ docker_info.containers_stopped }}</div>
        <div class="lbl">Stopped</div>
    </div>
    <div class="stat-cell">
        <div class="val">{{ docker_info.images }}</div>
        <div class="lbl">Images</div>
    </div>
    <div class="stat-cell">
        <div class="val" style="font-size:16px; padding-top:4px;">{{ docker_info.docker_version }}</div>
        <div class="lbl">Docker Version</div>
    </div>
</div>
{% endif %}

<!-- Running containers -->
<div class="section-title">Running Containers ({{ running|length }})</div>

{% if running %}
{% for c in running %}
<div class="container-card" id="card-{{ c.id }}">
    <div class="container-header" onclick="toggleCard(this)">

        <!-- Status dot -->
        <div class="status-dot status-running"></div>

        <!-- Name + image -->
        <div>
            <div class="container-name">{{ c.name }}</div>
            <div class="container-image">{{ c.image }} · {{ c.image_size_mb }}MB</div>
        </div>

        <!-- Metrics -->
        <div class="metrics-row">
            <div class="metric-chip">⏱ <span>{{ c.uptime }}</span></div>

            {% if c.cpu_percent is not none %}
            <div class="metric-chip">CPU <span>{{ c.cpu_percent }}%</span></div>
            {% endif %}

            {% if c.memory %}
            <div class="metric-chip">
                MEM <span>{{ c.memory.used_mb }}MB</span>
                <span class="mem-bar-wrap">
                    <span class="mem-bar-fill {% if c.memory.percent > 80 %}high{% elif c.memory.percent > 50 %}med{% endif %}"
                          style="width:{{ [c.memory.percent, 100]|min }}%"></span>
                </span>
            </div>
            {% endif %}

            {% for port in c.ports %}
            <a href="http://192.168.0.24:{{ port.host }}"
               target="_blank"
               class="port-link"
               onclick="event.stopPropagation()">
                :{{ port.host }} →
            </a>
            {% endfor %}
        </div>

        <div class="expand-arrow">▼</div>
    </div>

    <!-- Logs -->
    <div class="log-section">
        <div class="log-title">Last {{ c.log_lines|length }} log lines</div>
        {% if c.log_lines %}
        <div class="log-lines">{{ c.log_lines | join('\n') }}</div>
        {% else %}
        <div style="color:var(--text-dim); font-size:12px; font-family:'Space Mono',monospace;">No logs available</div>
        {% endif %}
    </div>
</div>
{% endfor %}

{% else %}
<div class="empty">No running containers found.</div>
{% endif %}

<!-- Networks -->
{% if networks %}
<div class="section-title" style="margin-top:1.5rem;">Docker Networks ({{ networks|length }})</div>
<div style="background:var(--bg2); border:1px solid var(--border); border-radius:8px; overflow:hidden; margin-bottom:1.5rem;">
    <table class="network-table">
        <thead>
            <tr>
                <th>Network</th>
                <th>Driver</th>
                <th>Containers</th>
            </tr>
        </thead>
        <tbody>
            {% for net in networks %}
            <tr>
                <td style="color:var(--cyan)">{{ net.name }}</td>
                <td>{{ net.driver }}</td>
                <td>{{ net.containers }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Stopped containers -->
{% if stopped %}
<div class="section-title">Stopped Containers ({{ stopped|length }})</div>
{% for c in stopped %}
<div class="stopped-card">
    <div class="status-dot status-stopped"></div>
    <div style="flex:1;">
        <span class="mono" style="font-size:13px;">{{ c.name }}</span>
        <span style="font-size:11px; color:var(--text-dim); margin-left:0.75rem; font-family:'Space Mono',monospace;">{{ c.image }}</span>
    </div>
    <span style="font-family:'Space Mono',monospace; font-size:11px; color:var(--red);">{{ c.status }}</span>
</div>
{% endfor %}
{% endif %}

<!-- Footer -->
<div style="text-align:center; padding:2rem 0 1rem; font-family:'Space Mono',monospace; font-size:11px; color:var(--text-dim);">
    Auto-refreshes every 30 seconds · Atlas Lab · zeus01 · 192.168.0.24
</div>

{% endblock %}
